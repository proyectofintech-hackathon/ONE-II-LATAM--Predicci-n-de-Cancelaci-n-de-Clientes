<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - KRIPTON</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="app-container">
    <aside class="sidebar">
        <div class="sidebar-header">
            <img src="/img/logo-kripton.png" alt="Logo" class="mini-big">
            <!--<span>KRIPTON</span>-->
        </div>
        <nav class="sidebar-nav">
            <a id="nav-dashboard" onclick="mostrarSeccion('dashboard')" class="nav-item active">üè† Inicio</a>
            <a id="nav-resumen" onclick="mostrarSeccion('resumen')" class="nav-item">üìä Resumen General</a>
            <a id="nav-clientes" onclick="mostrarSeccion('clientes')" class="nav-item">üë• Clientes</a>
            <a id="nav-registro" onclick="mostrarSeccion('registro')" class="nav-item">‚ûï Nuevo Cliente</a>
            <a id="nav-predicciones" onclick="mostrarSeccion('predicciones')" class="nav-item">üìà Predicciones</a>
            <a id="nav-config" onclick="mostrarSeccion('configuracion')" class="nav-item">‚öôÔ∏è Configuraci√≥n</a>
            <div class="nav-item" id="nav-plan-accion" onclick="mostrarSeccion('plan-accion')">
                <i class="fas fa-hand-holding-heart"></i> Plan de Acci√≥n
            </div>
        </nav>
        <div class="sidebar-footer">
            <div class="theme-switch-wrapper">
                <button id="btn-theme-toggle" class="btn-theme" onclick="toggleTheme()">
                    ‚òÄÔ∏è
                </button>
                <span class="text-muted" style="font-size: 12px;">Cambiar Tema</span>
            </div>
            <button class="logout-btn-sidebar" onclick="logout()">Cerrar Sesi√≥n</button>
        </div>
    </aside>

    <main class="main-content">
        <div id="section-bienvenida" class="content-section">
            <header class="main-header">
                <div>
                    <h1>¬°Bienvenido a KRYPTON!</h1>
                    <p class="text-muted" id="userGreeting">Cargando usuario...</p>
                </div>
            </header>
            <div class="welcome-container" style="text-align: center; margin-top: 50px;">
                <img src="/img/logo-kripton.png" alt="Logo Grande" style="width: 200px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
                <h2>Selecciona una opci√≥n en el men√∫ lateral para comenzar el an√°lisis.</h2>
            </div>
        </div>

        <div id="section-resumen" class="content-section" style="display: none;">
            <header class="main-header">
                <h1>Centro de Control Kripton</h1>
                <p class="text-muted">An√°lisis descriptivo de la cartera actual</p>
            </header>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-icon">üë•</span>
                    <div class="stat-info"><label>Total Clientes</label><h2 id="stat-total">10127</h2></div>
                </div>
                <div class="stat-card warning">
                    <span class="stat-icon">‚ö†Ô∏è</span>
                    <div class="stat-info"><label>En Riesgo Alto (Churn)</label><h2 id="stat-riesgo">1627</h2></div>
                </div>
                <div class="stat-card info">
                    <span class="stat-icon">üìÖ</span>
                    <div class="stat-info"><label>Inactividad Media</label><h2 id="stat-inactivo">2.3 meses</h2></div>
                </div>
            </div>

            <div class="charts-dashboard-row">
                <div class="chart-main-container">
                    <h3>üë• Distribuci√≥n por Rangos de Edad</h3>
                    <canvas id="chartBarrasEdad"></canvas>
                </div>

                <div class="chart-main-container">
                    <h3>üìà Tipos de Tarjetas Activas</h3>
                    <canvas id="chartBarrasTarjetas"></canvas>
                </div>

                <div class="chart-main-container">
                    <h3>üìâ Tendencia de Inactividad</h3>
                    <canvas id="chartLineaInactividad"></canvas>
                </div>
            </div>
        </div>

        <div id="section-clientes" class="content-section" style="display: none;">
            <header class="main-header">
                <h1>Gesti√≥n de Cartera</h1>
                <p class="text-muted">Filtrado avanzado y segmentaci√≥n de clientes</p>
            </header>

            <div class="filter-shell">
                <div class="filter-grid-pro">
                    <div class="filter-group-pro">
                        <label><i class="fas fa-search"></i> Identificador o Edad</label>
                        <input type="text" id="inputBusqueda" onkeyup="filtrarGeneral()" placeholder="Ej: 8805...">
                    </div>

                    <div class="filter-group-pro">
                        <label>G√©nero</label>
                        <select id="filterGender" onchange="filtrarGeneral()">
                            <option value="todos">Todos los g√©neros</option>
                            <option value="1">Hombre</option>
                            <option value="0">Mujer</option>
                        </select>
                    </div>

                    <div class="filter-group-pro">
                        <label>Nivel de Riesgo</label>
                        <select id="filterRisk" onchange="filtrarGeneral()">
                            <option value="todos">Todos los niveles</option>
                            <option value="alto">Riesgo Alto</option>
                            <option value="medio">Riesgo Medio (Alerta)</option>
                            <option value="bajo">Fiel (Riesgo Bajo)</option>
                        </select>
                    </div>

                    <div class="filter-group-pro">
                        <label>Meses de Inactividad</label>
                        <input type="number" id="filterInactive" onkeyup="filtrarGeneral()" placeholder="M√≠nimo de meses...">
                    </div>
                </div>
                <div class="filter-actions">
                    <button class="btn-clear-pro" onclick="limpiarFiltros()">
                        <span>üßπ Limpiar Filtros</span>
                    </button>
                </div>
            </div>

            <div class="table-container-pro">
                <div id="listaClientes"></div>
                <div id="paginacionControles" class="pagination-container"></div>
            </div>
        </div>
        <div id="section-predicciones" class="content-section" style="display: none;">

            <div class="main-header">
                <h1>Centro de Control de Riesgo</h1>
                <p class="text-muted">Monitoreo y predicci√≥n de retenci√≥n de clientes en tiempo real</p>
            </div>

            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-title">Tasa de Fuga Actual</div>
                    <div class="kpi-value" id="kpi-churn-rate">--%</div>
                    <div class="kpi-trend bad">üìà +2.4% vs mes anterior</div>
                </div>

                <div class="kpi-card warning-glow">
                    <div class="kpi-title">Clientes Perdidos/Riesgo</div>
                    <div class="kpi-value" id="kpi-risk-count">--</div>
                    <div class="kpi-icon">‚ö†Ô∏è</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-title">Tasa de Retenci√≥n</div>
                    <div class="kpi-value" id="kpi-retention">--%</div>
                    <div class="kpi-trend good">üöÄ Estable</div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-title">Impacto Financiero Est.</div>
                    <div class="kpi-value" id="kpi-impact">$--</div>
                    <div class="kpi-sub">Basado en LTV promedio</div>
                </div>
            </div>

            <div class="charts-row-pro">

                <div class="chart-card-pro big-chart">
                    <div class="chart-header">
                        <h3>Tendencia Mensual de Fuga</h3>
                        <span class="badge-tag">√öltimos 6 meses</span>
                    </div>
                    <div class="chart-body">
                        <canvas id="chartTendencia"></canvas>
                    </div>
                </div>

                <div class="chart-card-pro small-chart">
                    <div class="chart-header">
                        <h3>Distribuci√≥n de Riesgo</h3>
                    </div>
                    <div class="chart-body">
                        <canvas id="chartDistribucion"></canvas>
                    </div>
                    <div class="chart-legend-custom">
                        <div class="legend-item"><span class="dot green"></span>Activos</div>
                        <div class="legend-item"><span class="dot red"></span>Fuga Confirmada</div>
                    </div>
                </div>
            </div>

            <div class="prediction-card-main" style="margin-top: 30px;">
                <h3>üîÆ Consultar Cliente Espec√≠fico (IA en Vivo)</h3>
                <p class="text-muted">Introduce el ID del cliente para calcular su probabilidad futura.</p>

                <div class="search-ia-box">
                    <input type="number" id="inputPredictId" placeholder="Ej: 8805 (ID Cliente)">
                    <button class="btn-primary-glow" onclick="ejecutarPrediccionIndividual()">
                        ‚ú® Analizar con IA
                    </button>
                </div>
                <div id="resultadoIA" class="ia-result-container"></div>
            </div>
        </div>

        <div id="section-configuracion" class="content-section" style="display: none;">
            <div class="config-wrapper">
                <div class="config-card">
                    <div class="icon-circle">‚öôÔ∏è</div>
                    <h1>Configuraci√≥n</h1>
                    <p class="text-muted">Actualiza tus credenciales</p>

                    <div class="config-form" style="margin-top: 20px;">
                        <div class="input-group">
                            <label>Nuevo Nombre de Usuario</label>
                            <input type="text" id="configUser" placeholder="Escribe el nombre...">
                        </div>
                        <div class="input-group">
                            <label>Nueva Contrase√±a</label>
                            <input type="password" id="configPass" placeholder="M√≠nimo 8 caracteres...">
                        </div>
                        <button type="button" class="btn-update" onclick="guardarConfiguracion()">
                            Actualizar Perfil
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="section-registro" class="content-section" style="display: none;">
            <div class="registration-wrapper">
                <div class="registration-card">
                    <div class="icon-circle" style="margin: 0 auto 20px; background: rgba(0,210,255,0.1); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">üë§</div>
                    <h1>Alta de Nuevo Cliente</h1>
                    <p class="text-muted" style="text-align: center;">Completa todos los campos para evitar datos nulos en el an√°lisis.</p>

                    <form id="formRegistroCliente" onsubmit="event.preventDefault(); procesarAltaCliente();">
                        <div class="form-grid-2">
                            <div class="input-group-pro">
                                <label>Edad</label>
                                <input type="number" id="regEdad" placeholder="Ej: 45" required>
                            </div>
                            <div class="input-group-pro">
                                <label>G√©nero</label>
                                <select id="regGenero">
                                    <option value="1">Masculino</option>
                                    <option value="0">Femenino</option>
                                </select>
                            </div>
                            <div class="input-group-pro">
                                <label>Meses Inactivo</label>
                                <input type="number" id="regInactivo" placeholder="0 - 12" required>
                            </div>
                            <div class="input-group-pro">
                                <label>Contactos (12 meses)</label>
                                <input type="number" id="regContactos" placeholder="Cant. contactos" required>
                            </div>
                            <div class="input-group-pro">
                                <label>Tipo de Tarjeta</label>
                                <select id="regTarjeta">
                                    <option value="blue">Blue (Est√°ndar)</option>
                                    <option value="silver">Silver</option>
                                    <option value="gold">Gold</option>
                                    <option value="platinum">Platinum</option>
                                </select>
                            </div>
                            <div class="input-group-pro">
                                <label>Productos con baja relaci√≥n</label>
                                <input type="number" id="regLowRel" placeholder="Ej: 1" required>
                            </div>
                            <div class="input-group-pro">
                                <label>Ratio de Uso (0.0 a 1.0)</label>
                                <input type="number" step="0.01" id="regUso" placeholder="Ej: 0.15" required>
                            </div>
                            <div class="input-group-pro">
                                <label>Cambio Transaccional (Q4 vs Q1)</label>
                                <input type="number" step="0.001" id="regCambio" placeholder="Ej: 1.25" required>
                            </div>

                            <button type="submit" class="btn-save-client">
                                üíæ REGISTRAR EN BASE DE DATOS Y ANALIZAR
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div id="section-plan-accion" class="content-section" style="display: none;">
            <div class="main-header">
                <h1>An√°lisis Detallado de Retenci√≥n</h1>
                <p class="text-muted">Desglose de motivos detectados por Champion 3 y hoja de ruta.</p>
            </div>

            <div class="action-detail-container">
                <div class="client-info-banner" id="plan-client-header">
                </div>

                <div class="detail-grid">
                    <div class="detail-card">
                        <h3>üîç ¬øPor qu√© se quiere ir?</h3>
                        <div id="plan-motivos-lista" class="motivos-fuga-box">
                        </div>
                    </div>

                    <div class="detail-card">
                        <h3>üõ†Ô∏è Acciones Recomendadas</h3>
                        <div id="plan-acciones-especificas" class="acciones-box">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="krypton-footer">
            <div class="footer-container">
                <div class="footer-grid">
                    <div class="footer-column">
                        <h6 class="footer-title">S√≠guenos</h6>
                        <div class="footer-socials">
                            <a href="https://www.facebook.com/profile.php?id=61586669641962" target="_blank"><i class="fa-brands fa-facebook"></i></a>
                            <a href="https://www.linkedin.com/in/krypton-fintech-4967143a6/" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
                            <a href="https://x.com/KryptonFintech" target="_blank"><i class="fa-brands fa-x-twitter"></i></a>
                            <a href="https://www.instagram.com/krypton.fintech/" target="_blank"><i class="fa-brands fa-instagram"></i></a>
                            <a href="https://youtube.com/@krypton-fintech?si=s2ggf0rV7Vi-TQx6" target="_blank"><i class="fa-brands fa-youtube"></i></a>
                        </div>
                    </div>

                    <div class="footer-column">
                        <h6 class="footer-title">Nuestro Equipo</h6>
                        <p class="footer-text">
                            <a href="nosotros.html" class="team-badge" style="text-decoration: none;">
                                Ver Equipo 02 - H12 <i class="fas fa-external-link-alt"></i>
                            </a>
                        </p>
                    </div>

                    <div class="footer-column">
                        <a href="valores.html" style="text-decoration: none; color: inherit;">
                            <h6 class="footer-title">Cultura <i class="fas fa-chevron-right"></i></h6>
                            <p class="footer-text">Misi√≥n, Visi√≥n y Valores.</p>
                        </a>
                    </div>
                </div>
            </div>
        </footer>
    </main>

</div>

<div id="modalDetalles" class="modal-overlay">
    <div class="modal-content">
        <span class="modal-close" onclick="cerrarModalDetalles()">&times;</span>
        <h2>Expediente del Cliente</h2>
        <div id="modalBody" class="details-grid">
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="js/dashboard.js"></script>
</body>
</html>